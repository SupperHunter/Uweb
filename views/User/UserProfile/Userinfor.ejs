<style>
    .tab-pane {
        display: none;
    }

    .tab-pane.active {
        display: block;
    }

    /* Highlight the active menu item */
    .list-group-item.active {
        background-color: #eef1f6;
    }

    #cancelOrderBtn.disabled {
        background-color: #6c757d;
        /* Darker shade of red for disabled look */
        pointer-events: none;
        /* Prevent clicking */
        cursor: not-allowed;
        /* Change cursor to indicate it can't be clicked */
        opacity: 0.65;
        /* Slightly transparent */
    }
</style>

<script>

    function setActive(event, tabId) {
        // Loại bỏ class active khỏi tất cả các mục trong menu
        var listItems = document.querySelectorAll('.list-group-item');
        listItems.forEach(function (item) {
            item.classList.remove('active');
        });

        // Đặt class active cho menu item hiện tại
        event.currentTarget.classList.add('active');

        // Ẩn tất cả nội dung tab
        var tabs = document.querySelectorAll('.tab-pane');
        tabs.forEach(function (tab) {
            tab.classList.remove('active');
        });

        // Hiển thị nội dung tab được chọn
        var selectedTab = document.getElementById(tabId);
        if (selectedTab) {
            selectedTab.classList.add('active');
        }

        // Cập nhật URL hash
        window.location.hash = tabId;
    }

    // Hàm để kích hoạt tab dựa trên URL hash
    function activateTabFromHash() {
        var hash = window.location.hash.substring(1); // Loại bỏ dấu # khỏi hash
        if (hash) {
            // Loại bỏ class active khỏi tất cả các mục trong menu
            var listItems = document.querySelectorAll('.list-group-item');
            listItems.forEach(function (item) {
                item.classList.remove('active');
            });

            // Ẩn tất cả nội dung tab
            var tabs = document.querySelectorAll('.tab-pane');
            tabs.forEach(function (tab) {
                tab.classList.remove('active');
            });

            // Tìm mục menu và nội dung tab tương ứng
            var targetLink = document.querySelector('.list-group-item[href="#' + hash + '"]');
            var targetTab = document.getElementById(hash);

            // Kích hoạt nếu mục và tab tồn tại
            if (targetLink && targetTab) {
                targetLink.classList.add('active');
                targetTab.classList.add('active');
            }
        }
    }

    // Kích hoạt tab khi trang được tải nếu có hash trong URL
    window.addEventListener('load', activateTabFromHash);

    // Theo dõi sự thay đổi của URL hash (nếu người dùng bấm back/forward trên trình duyệt)
    window.addEventListener('hashchange', activateTabFromHash);
</script>
</head>

<body>
    <div class="modal" id="addPaymentModal" data-bs-backdrop="static" tabindex="-1"
        aria-labelledby="addPaymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addPaymentModalLabel">Add new payment method</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs mb-3" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button type="button" class="nav-link active" id="card-tab" data-bs-toggle="tab"
                                data-bs-target="#card-tab-pane" role="tab" aria-controls="card-tab-pane"
                                aria-selected="true">
                                <i class="ci-credit-card fs-base opacity-75 ms-n2 me-2"></i>
                                Card
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content" style="display: block;">
                        <div class="" style="display: block;" id="card-tab-pane" role="tabpanel"
                            aria-labelledby="card-tab">
                            <form action="/useraddaccount" id="addPaymentForm" method="post" class="needs-validation"
                                novalidate="">
                                <div class="mb-3">
                                    <label for="card-number" class="form-label">Card number</label>
                                    <div class="position-relative" data-input-format="{&quot;creditCard&quot;: true}">
                                        <input type="text" class="form-control form-icon-end" id="card-number"
                                            style="background-image: none" oninput="formatCardNumber(this)"
                                            maxlength="19" placeholder="XXXX XXXX XXXX XXXX" required name="cardNumber">
                                        <span
                                            class="position-absolute d-flex top-50 end-0 translate-middle-y fs-5 text-body-tertiary me-3"
                                            data-card-icon=""></span>
                                        <span id="card-error" style="color: red; display: none;">Invalid
                                            card number</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="card-name" class="form-label">Name on card</label>
                                    <input type="text" name="cardholderName" class="form-control" id="card-name"
                                        placeholder="Full name" required>
                                </div>
                                <div class="row mb-4">
                                    <div class="col-7">
                                        <label for="card-expiration" class="form-label">Expiration date</label>
                                        <input type="text" class="form-control" id="card-expiration"
                                            data-input-format="{&quot;date&quot;: true, &quot;datePattern&quot;: [&quot;m&quot;, &quot;y&quot;]}"
                                            placeholder="MM/YY" maxlength="5" pattern="(0[1-9]|1[0-2])\/\d{2}" required
                                            oninput="formatExpiryDate(this)" name="expiry">
                                    </div>
                                    <div class="col-5">
                                        <label for="card-cvc" class="form-label">CVC</label>
                                        <input type="text" class="form-control" id="card-cvc"
                                            data-input-format="{&quot;numericOnly&quot;: true, &quot;blocks&quot;: [3]}"
                                            placeholder="XXX" oninput="validateCVV(this)" minlength="3" maxlength="3"
                                            required name="cvv">
                                        <span id="cvv-error" style="color: red; display: none;">Invalid
                                            CVV</span>
                                    </div>
                                </div>
                                <div class="d-flex gap-3">
                                    <button type="reset" class="btn btn-secondary w-100" data-bs-dismiss="modal"
                                        data-bs-target="#addPaymentModal">Cancel</button>
                                    <button type="submit" class="btn btn-primary w-100">Add card</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    <div class="modal fade" id="newAddressModal" data-bs-backdrop="static" tabindex="-1"
        aria-labelledby="newAddressModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newAddressModalLabel">Add new address</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addnewaddress" action="/addnewaddress" class="row g-3 g-lg-4 needs-validation"
                        novalidate="">
                        <div class="col-lg-6">
                            <div class="position-relative">
                                <label class="form-label">Country</label>
                                <select class="form-select" name="country" id="country-select"
                                    aria-label="Select country" required="">
                                    <option value="">Select country...</option>
                                </select>
                                <div class="invalid-feedback">Please select your country!</div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="position-relative">
                                <label for="add-zip" class="form-label">ZIP code</label>
                                <input type="text" name="postalCode" class="form-control" id="add-zip" required="">
                                <div class="invalid-feedback">Please enter your ZIP code!</div>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="position-relative">
                                <label for="add-address" class="form-label">Address</label>
                                <input type="text" name="street" class="form-control" id="add-address" required="">
                                <div class="invalid-feedback">Please enter your address!</div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-check mb-0">
                                <input type="checkbox" class="form-check-input" id="set-primary-3">
                                <!-- <label for="set-primary-3" class="form-check-label">Set as primary address</label> -->
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="d-flex gap-3 pt-2 pt-sm-0">
                                <button type="submit" class="btn btn-primary">Add address</button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>




    <!-- Order details offcanvas -->
    <div class="offcanvas offcanvas-end pb-sm-2 px-sm-2" id="orderDetails" tabindex="-1"
        aria-labelledby="orderDetailsLabel" style="width: 500px">
        <div class="offcanvas-header align-items-start py-3 pt-lg-4">
            <div>
                <h4 class="offcanvas-title mb-1" id="orderDetailsLabel">Order # 78A6431D409</h4>
                <span id="ProcessStatus" class="d-flex align-items-center fs-sm fw-medium text-body-emphasis">
                    <span id="status-indicator" class="bg-info rounded-circle p-1 me-2"></span>
                    In progress
                </span>
            </div>
            <button type="button" class="btn-close mt-0" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body d-flex flex-column gap-4 pt-2 pb-3">
            <div id="showitem">
            </div>
            <div class="border-top pt-4">
                <h6>Delivery</h6>
                <ul class="list-unstyled fs-sm mb-4">
                    <li class="d-flex justify-content-between mb-1">
                        Estimated delivery date:
                        <span class="text-body-emphasis fw-medium text-end ms-2 dateorder"></span>
                    </li>
                    <li class="d-flex justify-content-between mb-1">
                        Shipping method:
                        <span class="text-body-emphasis fw-medium text-end ms-2">Delivery</span>
                    </li>
                    <li class="d-flex justify-content-between">
                        Shipping address:
                        <span class="text-body-emphasis fw-medium text-end ms-2 Shippingaddress"></span>
                    </li>
                    <li class="d-flex justify-content-between">
                        Tracking:
                        <span class="text-body-emphasis fw-medium text-end ms-2 Tracking"></span>
                    </li>
                    <li class="d-flex justify-content-between">
                        shipping:
                        <span class="text-body-emphasis fw-medium text-end ms-2">5$</span>
                    </li>
                    <li class="d-flex justify-content-between">
                        tax:
                        <span class="text-body-emphasis fw-medium text-end ms-2">25$</span>
                    </li>
                </ul>
            </div>
            <div class="d-flex align-items-center justify-content-between fs-sm border-top pt-4">
                Estimated total:
                <span class="h5 text-end ms-2 mb-0 Estimatedtotal"></span>
            </div>
        </div>
        <div class="offcanvas-header cancelbtnoff">
        </div>
    </div>


    <main class="content-wrapper">
        <div class="container py-5 mt-n2 mt-sm-0">
            <div class="row pt-md-2 pt-lg-3 pb-sm-2 pb-md-3 pb-lg-4 pb-xl-5">


                <!-- Sidebar navigation that turns into offcanvas on screens < 992px wide (lg breakpoint) -->
                <aside class="col-lg-3">
                    <div class="offcanvas-lg offcanvas-start pe-lg-0 pe-xl-4" id="accountSidebar">

                        <!-- Header -->
                        <div class="offcanvas-header d-lg-block py-3 p-lg-0">
                            <div class="d-flex align-items-center">
                                <div class="h5 d-flex justify-content-center align-items-center flex-shrink-0 text-primary bg-primary-subtle lh-1 rounded-circle mb-0"
                                    style="width: 3rem; height: 3rem">S</div>
                                <div class="min-w-0 ps-3">
                                    <h5 class="h6 mb-1">
                                        <%=user.username%>
                                    </h5>
                                    <div class="nav flex-nowrap text-nowrap min-w-0">
                                        <a class="nav-link animate-underline text-body p-0" href="#bonusesModal"
                                            data-bs-toggle="modal">
                                            <svg class="text-warning flex-shrink-0 me-2"
                                                xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                fill="currentColor">
                                                <path
                                                    d="M1.333 9.667H7.5V16h-5c-.64 0-1.167-.527-1.167-1.167V9.667zm13.334 0v5.167c0 .64-.527 1.167-1.167 1.167h-5V9.667h6.167zM0 5.833V7.5c0 .64.527 1.167 1.167 1.167h.167H7.5v-1-3H1.167C.527 4.667 0 5.193 0 5.833zm14.833-1.166H8.5v3 1h6.167.167C15.473 8.667 16 8.14 16 7.5V5.833c0-.64-.527-1.167-1.167-1.167z">
                                                </path>
                                                <path
                                                    d="M8 5.363a.5.5 0 0 1-.495-.573C7.752 3.123 9.054-.03 12.219-.03c1.807.001 2.447.977 2.447 1.813 0 1.486-2.069 3.58-6.667 3.58zM12.219.971c-2.388 0-3.295 2.27-3.595 3.377 1.884-.088 3.072-.565 3.756-.971.949-.563 1.287-1.193 1.287-1.595 0-.599-.747-.811-1.447-.811z">
                                                </path>
                                                <path
                                                    d="M8.001 5.363c-4.598 0-6.667-2.094-6.667-3.58 0-.836.641-1.812 2.448-1.812 3.165 0 4.467 3.153 4.713 4.819a.5.5 0 0 1-.495.573zM3.782.971c-.7 0-1.448.213-1.448.812 0 .851 1.489 2.403 5.042 2.566C7.076 3.241 6.169.971 3.782.971z">
                                                </path>
                                            </svg>
                                            <span class="animate-target me-1">100 bonuses</span>
                                            <span class="text-body fw-normal text-truncate">available</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn-close d-lg-none" data-bs-dismiss="offcanvas"
                                data-bs-target="#accountSidebar" aria-label="Close"></button>
                        </div>

                        <!-- Body (Navigation) -->
                        <div class="offcanvas-body d-block pt-2 pt-lg-4 pb-lg-0">
                            <nav class="list-group list-group-borderless">
                                <a class="list-group-item list-group-item-action d-flex align-items-center active"
                                    href="#orders" onclick="setActive(event, 'orders')">
                                    <i class="ci-shopping-bag fs-base opacity-75 me-2"></i>
                                    Orders
                                </a>
                                <a class="list-group-item list-group-item-action d-flex align-items-center"
                                    href="#wishlist" onclick="setActive(event, 'wishlist')">
                                    <i class="ci-heart fs-base opacity-75 me-2"></i>
                                    Wishlist
                                </a>
                                <a class="list-group-item list-group-item-action d-flex align-items-center"
                                    href="#payment" onclick="setActive(event, 'payment')">
                                    <i class="ci-credit-card fs-base opacity-75 me-2"></i>
                                    Payment methods
                                </a>
                            </nav>
                            <h6 class="pt-4 ps-2 ms-1">Manage account</h6>
                            <nav class="list-group list-group-borderless">
                                <!-- <a class="list-group-item list-group-item-action d-flex align-items-center"
                                    href="#accountinfo" onclick="setActive(event , 'accountinfor')">
                                    <i class="ci-user fs-base opacity-75 me-2"></i>
                                    Personal info
                                </a> -->
                                <a class="list-group-item list-group-item-action d-flex align-items-center"
                                    href="#address" onclick="setActive(event  , 'address')">
                                    <i class="ci-map-pin fs-base opacity-75 me-2"></i>
                                    Addresses
                                </a>
                            </nav>
                            <nav class="list-group list-group-borderless pt-3">
                                <a class="list-group-item list-group-item-action d-flex align-items-center"
                                    href="/logout">
                                    <i class="ci-log-out fs-base opacity-75 me-2"></i>
                                    Log out
                                </a>
                            </nav>
                        </div>
                    </div>
                </aside>


                <!-- Orders content -->

                <div id="orders" class="col-lg-9 tab-pane active">
                    <div class="ps-lg-3 ps-xl-0">

                        <!-- Page title + Sorting selects -->
                        <div class="row align-items-center pb-3 pb-md-4 mb-md-1 mb-lg-2">
                            <div class="col-md-4 col-xl-6 mb-3 mb-md-0">
                                <h1 class="h2 me-3 mb-0">Orders</h1>
                            </div>
                        </div>
                        <div
                            data-filter-list="{&quot;listClass&quot;: &quot;orders-list&quot;, &quot;sortClass&quot;: &quot;orders-sort&quot;, &quot;valueNames&quot;: [&quot;date&quot;, &quot;total&quot;]}">
                            <table class="table align-middle fs-sm text-nowrap">
                                <thead>
                                    <tr>
                                        <th scope="col" class="py-3 ps-0">
                                            <span class="text-body fw-normal">Order <span
                                                    class="d-none d-md-inline">#</span></span>
                                        </th>
                                        <th scope="col" class="py-3 d-none d-md-table-cell">
                                            <button type="button" class="btn orders-sort fw-normal text-body p-0"
                                                data-sort="date">Order
                                                date</button>
                                        </th>
                                        <th scope="col" class="py-3 d-none d-md-table-cell">
                                            <span class="text-body fw-normal">Status</span>
                                        </th>
                                        <th scope="col" class="py-3 d-none d-md-table-cell">
                                            <button type="button" class="btn orders-sort fw-normal text-body p-0"
                                                data-sort="total">Total</button>
                                        </th>
                                        <th scope="col" class="py-3">&nbsp;</th>
                                    </tr>
                                </thead>
                                <tbody class="text-body-emphasis orders-list">
                                    <% orders.forEach(order=> { %>
                                        <tr>
                                            <!-- Order ID (hoặc bất kỳ mã đơn hàng nào bạn có) -->
                                            <td class="fw-medium pt-2 pb-3 py-md-2 ps-0">
                                                <a class="d-inline-block animate-underline text-body-emphasis text-decoration-none py-2"
                                                    href="getorderNologin?email=''&Orderid=<%= order.id %>"
                                                    aria-label="Show order details">
                                                    <span class="animate-target">
                                                        <%= order.id %>
                                                    </span> <!-- Order ID -->
                                                </a>
                                                <ul class="list-unstyled fw-normal text-body m-0 d-md-none">
                                                    <li>
                                                        <%= new Date(order.orderDate).toLocaleDateString() %>
                                                            <!-- Ngày đặt hàng -->
                                                    </li>
                                                    <li class="d-flex align-items-center">
                                                        <span
                                                            class="rounded-circle p-1 me-2 
                                                                <% if (order.status == 'Placed') { %> bg-primary <% } %>
                                                                <% if (order.status == 'Preparing') { %> bg-warning <% } %>
                                                                <% if (order.status == 'On the way') { %> bg-info <% } %>
                                                                <% if (order.status == 'Delivered') { %> bg-success <% } %>
                                                                <% if (order.status == 'Cancel') { %> bg-danger <% } %>">
                                                        </span>
                                                        <%= order.status %>
                                                    </li>
                                                    <li class="fw-medium text-body-emphasis">$<%=
                                                            order.totalAmount.toFixed(2) %> <!-- Tổng số tiền -->
                                                    </li>
                                                </ul>
                                            </td>

                                            <!-- Ngày đặt hàng -->
                                            <td class="fw-medium py-3 d-none d-md-table-cell">
                                                <%= new Date(order.orderDate).toLocaleDateString() %>
                                                    <!-- Hiển thị ngày ở chế độ Desktop -->
                                            </td>

                                            <!-- Trạng thái đơn hàng -->
                                            <td class="fw-medium py-3 d-none d-md-table-cell">
                                                <span class="d-flex align-items-center">
                                                    <span
                                                        class="rounded-circle p-1 me-2 
                                                                                                                    <% if (order.status == 'Placed') { %> bg-primary <% } %>
                                                                                                                    <% if (order.status == 'Preparing') { %> bg-warning <% } %>
                                                                                                                    <% if (order.status == 'On the way') { %> bg-info <% } %>
                                                                                                                    <% if (order.status == 'Delivered') { %> bg-success <% } %>
                                                                                                                    <% if (order.status == 'Cancel') { %> bg-danger <% } %>">
                                                    </span>
                                                    <%= order.status %>
                                                </span>
                                            </td>

                                            <!-- Tổng tiền đơn hàng -->
                                            <td class="fw-medium py-3 d-none d-md-table-cell">
                                                $<%= order.totalAmount.toFixed(2) %> <!-- Tổng tiền đơn hàng -->
                                                    <span class="total d-none">
                                                        <%= order.totalAmount %>
                                                    </span>
                                            </td>

                                            <!-- Hình ảnh sản phẩm từ chi tiết đơn hàng -->
                                            <td class="py-3 pe-0">
                                                <span
                                                    class="d-flex align-items-center justify-content-end position-relative gap-1 gap-sm-2 ms-n2 ms-sm-0">
                                                    <% order.orderDetails.forEach(orderDetail=> { %>
                                                        <span>
                                                            <img src="<%= orderDetail.product.images[0].url %>"
                                                                width="64" alt="Thumbnail">
                                                            <!-- Hình ảnh sản phẩm -->
                                                        </span>
                                                        <% }) %>
                                                            <a class="btn btn-icon btn-ghost btn-secondary stretched-link border-0"
                                                                href="#orderDetails" data-bs-toggle="offcanvas"
                                                                aria-controls="orderDetails"
                                                                aria-label="Show order details"
                                                                onclick="showOrderDetails(<%= JSON.stringify(order) %>)">
                                                                <i class="ci-chevron-right fs-lg"></i>
                                                            </a>
                                                </span>
                                            </td>
                                        </tr>
                                        <% }) %>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>



                <div id="payment" class="col-lg-9 tab-pane">
                    <div class="ps-lg-3 ps-xl-0">

                        <!-- Page title -->
                        <h1 class="h2 pb-2 pb-md-3">Payment methods</h1>

                        <!-- Payment methods (Grid) -->
                        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3 g-md-4 g-lg-3 g-xl-4">

                            <% user.payments.forEach((pay, index)=> { %>
                                <div class="col">
                                    <div class="card h-100 view-details" data-card-number="<%= pay.cardNumber %>"
                                        data-expiry="<%= pay.expiry %>" style="cursor: pointer;">
                                        <div class="card-body pb-3">
                                            <div class="d-flex align-items-start justify-content-between mb-4">
                                                <% if (pay.cardNumber.startsWith('4')) { %>
                                                    <img src="/client2/assets/img/payment-methods/visa-light-mode.svg"
                                                        class="d-none-dark m-n3" width="100" alt="Visa">
                                                    <% } else if (pay.cardNumber.startsWith('5')) { %>
                                                        <img src="/client2/assets/img/payment-methods/mastercard.svg"
                                                            class="d-none-dark m-n3" width="100" alt="Mastercard">
                                                        <% } %>
                                                            <img src="/client2/assets/img/payment-methods/visa-dark-mode.svg"
                                                                class="d-none d-block-dark m-n3" width="100" alt="Visa">
                                            </div>
                                            <div class="h6 mb-1">
                                                <%= '**** **** **** ' + pay.cardNumber.slice(-4) %>
                                            </div>
                                            <div class="text-body fs-xs">Expiration <%= pay.expiry.slice(0, 2) +
                                                    pay.expiry.slice(2, 4) %>
                                            </div>
                                        </div>
                                        <div class="card-footer d-flex gap-3 bg-transparent border-0 pt-0 pb-4">
                                            <!-- Optionally, you can add additional actions here -->
                                        </div>
                                    </div>
                                </div>
                                <% }); %>


                                    <div class="col">
                                        <div class="card border-0 h-100">
                                            <span
                                                class="position-absolute top-0 start-0 w-100 h-100 border border-dashed border-secondary border-opacity-25 rounded d-none-dark"></span>
                                            <span
                                                class="position-absolute top-0 start-0 w-100 h-100 border border-dashed border-light border-opacity-25 rounded d-none d-block-dark"></span>
                                            <div
                                                class="card-body position-relative z-2 nav align-items-center justify-content-center py-5">
                                                <a class="nav-link animate-underline stretched-link min-w-0 fs-base px-0"
                                                    href="#addPaymentModal" data-bs-toggle="modal">
                                                    <i class="ci-plus fs-lg ms-n2 me-2"></i>
                                                    <span class="animate-target text-truncate">Add payment method</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                        </div>
                    </div>
                </div>




                <div id="wishlist" class="col-lg-9 tab-pane">
                    <div class="ps-lg-3 ps-xl-0">

                        <!-- Wishlist selector -->
                        <div class="border-bottom pb-4 mb-3">
                            <div class="row align-items-center justify-content-between">
                                <div class="col-sm-7 col-md-8 col-xxl-9 d-flex align-items-center mb-3 mb-sm-0">
                                    <h5 class="me-2 mb-0">Interesting offers</h5>
                                    <div class="dropdown ms-auto ms-sm-0">
                                        <div class="dropdown-menu dropdown-menu-end">
                                            <div class="d-flex flex-column gap-1 mb-2">
                                                <div class="form-check">
                                                    <input type="radio" class="form-check-input" id="wishlist-1"
                                                        name="wishlist" checked="">
                                                    <label for="wishlist-1"
                                                        class="form-check-label text-body">Interesting
                                                        offers</label>
                                                </div>
                                                <div class="form-check">
                                                    <input type="radio" class="form-check-input" id="wishlist-2"
                                                        name="wishlist">
                                                    <label for="wishlist-2" class="form-check-label text-body">Top picks
                                                        collection</label>
                                                </div>
                                                <div class="form-check">
                                                    <input type="radio" class="form-check-input" id="wishlist-3"
                                                        name="wishlist">
                                                    <label for="wishlist-3" class="form-check-label text-body">Family
                                                        stuff</label>
                                                </div>
                                                <div class="form-check">
                                                    <input type="radio" class="form-check-input" id="wishlist-4"
                                                        name="wishlist">
                                                    <label for="wishlist-4" class="form-check-label text-body">My
                                                        must-haves</label>
                                                </div>
                                                <div class="form-check">
                                                    <input type="radio" class="form-check-input" id="wishlist-5"
                                                        name="wishlist">
                                                    <label for="wishlist-5" class="form-check-label text-body">For my
                                                        husband</label>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-sm btn-dark w-100"
                                                onclick="document.getElementById('wishlist-selector').click()">Select
                                                wishlist</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Master checkbox + Action buttons -->
                        <div class="nav align-items-center mb-4">
                            <div class="form-checkl nav-link animate-underline fs-lg ps-0 pe-2 py-2 mt-n1 me-4"
                                data-master-checkbox="{&quot;container&quot;: &quot;#wishlistSelection&quot;, &quot;label&quot;: &quot;Select all&quot;, &quot;labelChecked&quot;: &quot;Unselect all&quot;, &quot;showOnCheck&quot;: &quot;#action-buttons&quot;}">
                                <input type="checkbox" class="form-check-input" id="wishlist-master" checked="">
                                <label for="wishlist-master" class="form-check-label animate-target mt-1 ms-2">Unselect
                                    all</label>
                            </div>
                            <div class="d-flex flex-wrap" id="action-buttons">
                                <a class="nav-link animate-underline px-0 pe-sm-2 py-2 me-4" href="#!">
                                    <i class="ci-shopping-cart fs-base me-2"></i>
                                    <span class="animate-target d-none d-md-inline">Add to cart</span>
                                </a>
                                <a class="nav-link animate-underline px-0 pe-sm-2 py-2 me-4" href="#!">
                                    <i class="ci-repeat fs-base me-2"></i>
                                    <span class="animate-target d-none d-md-inline">Relocate</span>
                                </a>
                                <a class="nav-link animate-underline px-0 py-2" href="#!">
                                    <i class="ci-trash fs-base me-1"></i>
                                    <span class="animate-target d-none d-md-inline">Remove selected</span>
                                </a>
                            </div>
                        </div>


                        <!-- Wishlist items (Grid) -->
                        <div class="row row-cols-2 row-cols-md-3 g-4" id="wishlistSelection">

                        </div>
                    </div>
                </div>



                <div id="accountinfor" class="col-lg-9 tab-pane">
                    <div class="ps-lg-3 ps-xl-0">

                        <!-- Page title -->
                        <h1 class="h2 mb-1 mb-sm-2">Personal info</h1>

                        <!-- Basic info -->
                        <div class="border-bottom py-4">
                            <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
                                <h2 class="h6 mb-0">
                                    <% user.name %>
                                </h2>
                                <a class="nav-link hiding-collapse-toggle text-decoration-underline p-0 collapsed"
                                    href="#" data-bs-toggle="collapse" aria-expanded="false"
                                    aria-controls="basicInfoPreview basicInfoEdit">Edit</a>
                            </div>
                            <div class="collapse basic-info show" id="basicInfoPreview">
                                <ul class="list-unstyled fs-sm m-0">
                                    <li>Susan Gardner</li>
                                    <li>May 12, 1996</li>
                                    <li>English</li>
                                </ul>
                            </div>
                            <div class="collapse basic-info" id="basicInfoEdit">
                                <form class="row g-3 g-sm-4 needs-validation" novalidate="">
                                    <div class="col-sm-6">
                                        <label for="fn" class="form-label">First name</label>
                                        <div class="position-relative">
                                            <input type="text" class="form-control" id="fn" value="Susan" required="">
                                            <div class="invalid-feedback">Please enter your first name!</div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="ln" class="form-label">Last name</label>
                                        <div class="position-relative">
                                            <input type="text" class="form-control" id="ln" value="Gardner" required="">
                                            <div class="invalid-feedback">Please enter your last name!</div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="birthdate" class="form-label">Date of birth</label>
                                        <div class="position-relative">
                                            <input type="text" class="form-control form-icon-end" id="birthdate"
                                                data-datepicker="{
                                          &quot;dateFormat&quot;: &quot;F j, Y&quot;,
                                          &quot;defaultDate&quot;: &quot;May 15, 1996&quot;
                                        }" placeholder="Choose date">
                                            <i
                                                class="ci-calendar position-absolute top-50 end-0 translate-middle-y me-3"></i>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <label class="form-label">Language</label>
                                        <select class="form-select" data-select="{
                                        &quot;placeholderValue&quot;: &quot;Select language&quot;,
                                        &quot;choices&quot;: [
                                          {
                                            &quot;value&quot;: &quot;&quot;,
                                            &quot;label&quot;: &quot;Select language&quot;,
                                            &quot;placeholder&quot;: true
                                          },
                                          {
                                            &quot;value&quot;: &quot;English&quot;,
                                            &quot;label&quot;: &quot;<div class=\&quot;d-flex align-items-center\&quot;><img src=_assets/img/flags/en-us.png/_.html class=\&quot;flex-shrink-0 me-2\&quot; width=\&quot;20\&quot; alt=\&quot;English\&quot;> English</div>&quot;,
                                            &quot;selected&quot;: true
                                          },
                                          {
                                            &quot;value&quot;: &quot;Français&quot;,
                                            &quot;label&quot;: &quot;<div class=\&quot;d-flex align-items-center\&quot;><img src=_assets/img/flags/fr.png/_.html class=\&quot;flex-shrink-0 me-2\&quot; width=\&quot;20\&quot; alt=\&quot;Français\&quot;> Français</div>&quot;
                                          },
                                          {
                                            &quot;value&quot;: &quot;Deutsch&quot;,
                                            &quot;label&quot;: &quot;<div class=\&quot;d-flex align-items-center\&quot;><img src=_assets/img/flags/de.png/_.html class=\&quot;flex-shrink-0 me-2\&quot; width=\&quot;20\&quot; alt=\&quot;Deutsch\&quot;> Deutsch</div>&quot;
                                          },
                                          {
                                            &quot;value&quot;: &quot;Italiano&quot;,
                                            &quot;label&quot;: &quot;<div class=\&quot;d-flex align-items-center\&quot;><img src=_assets/img/flags/it.png/_.html class=\&quot;flex-shrink-0 me-2\&quot; width=\&quot;20\&quot; alt=\&quot;Italiano\&quot;> Italiano</div>&quot;
                                          }
                                        ]
                                      }" data-select-template="true"></select>
                                    </div>
                                    <div class="col-12">
                                        <div class="d-flex gap-3 pt-2 pt-sm-0">
                                            <button type="submit" class="btn btn-primary">Save changes</button>
                                            <button type="button" class="btn btn-secondary" data-bs-toggle="collapse"
                                                data-bs-target=".basic-info" aria-expanded="true"
                                                aria-controls="basicInfoPreview basicInfoEdit">Close</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Contact -->
                        <div class="border-bottom py-4">
                            <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
                                <div class="d-flex align-items-center gap-3 me-4">
                                    <h2 class="h6 mb-0">Contact</h2>
                                </div>
                                <a class="nav-link hiding-collapse-toggle text-decoration-underline p-0 collapsed"
                                    href="#" data-bs-toggle="collapse" aria-expanded="false"
                                    aria-controls="contactInfoPreview contactInfoEdit">Edit</a>
                            </div>
                            <div class="collapse contact-info show" id="contactInfoPreview">
                                <ul class="list-unstyled fs-sm m-0">
                                    <li class="mb-1">susan.gardner@email.com</li>
                                    <li>+1 (805) 348 95 72 <span class="text-success ms-1">Verified</span></li>
                                </ul>
                            </div>
                            <div class="collapse contact-info" id="contactInfoEdit">
                                <form class="row g-3 g-sm-4 needs-validation" novalidate="">
                                    <div class="col-sm-6">
                                        <label for="email" class="form-label">Email address</label>
                                        <div class="position-relative">
                                            <input type="email" class="form-control" id="email"
                                                value="susan.gardner@email.com" required="">
                                            <div class="invalid-feedback">Please enter a valid email address!</div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="phone" class="form-label">Phone number</label>
                                        <div class="position-relative">
                                            <input type="text" class="form-control" id="phone"
                                                data-input-format="{&quot;numericOnly&quot;: true, &quot;delimiters&quot;: [&quot;+1 (&quot;, &quot;)&quot;, &quot; &quot;], &quot;blocks&quot;: [0, 3, 0, 3, 2, 2]}"
                                                placeholder="+1 (___) ___ __ __" value="+1 (805) 348 95 72" required="">
                                            <div class="invalid-feedback">Please enter your phone number!</div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="d-flex gap-3 pt-2 pt-sm-0">
                                            <button type="submit" class="btn btn-primary">Save changes</button>
                                            <button type="button" class="btn btn-secondary" data-bs-toggle="collapse"
                                                data-bs-target=".contact-info" aria-expanded="true"
                                                aria-controls="contactInfoPreview contactInfoEdit">Close</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Password -->
                        <div class="border-bottom py-4">
                            <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
                                <div class="d-flex align-items-center gap-3 me-4">
                                    <h2 class="h6 mb-0">Password</h2>
                                </div>
                                <a class="nav-link hiding-collapse-toggle text-decoration-underline p-0 collapsed"
                                    href="#" data-bs-toggle="collapse" aria-expanded="false"
                                    aria-controls="passChangePreview passChangeEdit">Edit</a>
                            </div>
                            <div class="collapse password-change show" id="passChangePreview">
                                <ul class="list-unstyled fs-sm m-0">
                                    <li>**************</li>
                                </ul>
                            </div>
                            <div class="collapse password-change" id="passChangeEdit">
                                <form class="row g-3 g-sm-4 needs-validation" novalidate="">
                                    <div class="col-sm-6">
                                        <label for="current-password" class="form-label">Current password</label>
                                        <div class="password-toggle">
                                            <input type="password" class="form-control" id="current-password"
                                                placeholder="Enter your current password" required="">
                                            <label class="password-toggle-button" aria-label="Show/hide password">
                                                <input type="checkbox" class="btn-check">
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="new-password" class="form-label">New password</label>
                                        <div class="password-toggle">
                                            <input type="password" class="form-control" id="new-password"
                                                placeholder="Create new password" required="">
                                            <label class="password-toggle-button" aria-label="Show/hide password">
                                                <input type="checkbox" class="btn-check">
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="d-flex gap-3 pt-2 pt-sm-0">
                                            <button type="submit" class="btn btn-primary">Save changes</button>
                                            <button type="button" class="btn btn-secondary" data-bs-toggle="collapse"
                                                data-bs-target=".password-change" aria-expanded="true"
                                                aria-controls="passChangePreview passChangeEdit">Close</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Delete account -->
                        <div class="pt-3 mt-2 mt-sm-3">
                            <h2 class="h6">Delete account</h2>
                            <p class="fs-sm">When you delete your account, your public profile will be deactivated
                                immediately. If you
                                change your mind before the 14 days are up, sign in with your email and password, and
                                we'll send you a
                                link to reactivate your account.</p>
                            <a class="text-danger fs-sm fw-medium" href="#!">Delete account</a>
                        </div>
                    </div>
                </div>



                <div id="address" class="col-lg-9 tab-pane">
                    <div class="ps-lg-3 ps-xl-0">

                        <!-- Page title -->
                        <h1 class="h2 mb-1 mb-sm-2">Addresses</h1>
                        <div class="border-bottom py-4">
                            <% user.addresses.forEach((address, index)=> { %>
                                <div class="mb-4"> <!-- Add margin-bottom to create space between addresses -->
                                    <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
                                        <div class="d-flex align-items-center gap-3 me-4">
                                            <h2 class="h6 mb-0">Alternative shipping address <%= index + 1 %>
                                            </h2> <!-- Optional index display -->
                                        </div>
                                        <a class="nav-link hiding-collapse-toggle text-decoration-underline p-0 collapsed"
                                            href="-8.html" data-bs-toggle="collapse" aria-expanded="false"
                                            aria-controls="alternativeAddressPreview alternativeAddressEdit"></a>
                                    </div>
                                    <div class="collapse alternative-address show" id="alternativeAddressPreview">
                                        <ul class="list-unstyled fs-sm m-0">
                                            <li>
                                                <%= address.country %>
                                                    <%= address.postalCode %>, <%= address.state || 'State N/A' %>
                                            </li>
                                            <li>
                                                <%= address.street %>, <%= address.city || 'City N/A' %>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <% }); %>
                                    <div class="collapse alternative-address" id="alternativeAddressEdit">
                                        <form class="row g-3 g-sm-4 needs-validation" novalidate="">
                                            <div class="col-sm-6">
                                                <div class="position-relative">
                                                    <label class="form-label">Country</label>

                                                    <select class="form-select" id="country-select"
                                                        aria-label="Select country" required="">
                                                        <option value="">Select country...</option>
                                                    </select>
                                                    <div class="invalid-feedback">Please select your country!</div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="position-relative">
                                                    <label class="form-label">City</label>
                                                    <select class="form-select" id="city-select"
                                                        aria-label="Select city" required="">
                                                        <option value="">Select city...</option>
                                                    </select>
                                                    <div class="invalid-feedback">Please select your city!</div>
                                                </div>
                                            </div>
                                            <div class="col-sm-4">
                                                <div class="position-relative">
                                                    <label for="asa-zip" class="form-label">ZIP code</label>
                                                    <input type="text" class="form-control" id="asa-zip" value="32806"
                                                        required="">
                                                    <div class="invalid-feedback">Please enter your ZIP code!</div>
                                                </div>
                                            </div>
                                            <div class="col-sm-8">
                                                <div class="position-relative">
                                                    <label for="asa-address" class="form-label">Address</label>
                                                    <input type="text" class="form-control" id="asa-address"
                                                        value="514 S. Magnolia St." required="">
                                                    <div class="invalid-feedback">Please enter your address!</div>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-check mb-0">
                                                    <input type="checkbox" class="form-check-input" id="set-primary-2">
                                                    <label for="set-primary-2" class="form-check-label">Set as
                                                        primary
                                                        address</label>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="d-flex gap-3 pt-2 pt-sm-0">
                                                    <button type="submit" class="btn btn-primary">Save
                                                        changes</button>
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-toggle="collapse" data-bs-target=".alternative-address"
                                                        aria-expanded="true"
                                                        aria-controls="alternativeAddressPreview alternativeAddressEdit">Close</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                        </div>

                        <!-- Add address button -->
                        <div class="nav pt-4">
                            <a class="nav-link animate-underline fs-base px-0" href="#newAddressModal"
                                data-bs-toggle="modal">
                                <i class="ci-plus fs-lg ms-n1 me-2"></i>
                                <span class="animate-target">Add address</span>
                            </a>
                        </div>
                    </div>
                </div>




                <div id="reviews" class="tab-pane">
                    <!-- My reviews Content -->
                    <h2>Your Reviews</h2>
                    <p>Review details go here.</p>
                </div>
            </div>
        </div>
    </main>
    <!-- Sidebar navigation offcanvas toggle that is visible on screens < 992px wide (lg breakpoint) -->
    <button type="button"
        class="fixed-bottom z-sticky w-100 btn btn-lg btn-dark border-0 border-top border-light border-opacity-10 rounded-0 pb-4 d-lg-none"
        data-bs-toggle="offcanvas" data-bs-target="#accountSidebar" aria-controls="accountSidebar"
        data-bs-theme="light">
        <i class="ci-sidebar fs-base me-2"></i>
        Account menu
    </button>


    <div class="modal fade" id="paymentDetailsModal" tabindex="-1" aria-labelledby="paymentDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentDetailsModalLabel">Card Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Card Number:</strong> <span id="cardNumber"></span></p>
                    <p><strong>Expiration:</strong> <span id="cardExpiry"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Vendor scripts -->
    <script src="/client2/assets/vendor/choices.js/choices.min.js"></script>
    <script src="/client2/assets/vendor/list.js/list.min.js"></script>

    <!-- Bootstrap + Theme scripts -->
    <script src="/client2/assets/js/theme.min.js"></script>
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap JS (Optional if using Bootstrap modals or other JS features) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- jQuery-confirm CSS and JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js"></script>

    <script>


        $(document).ready(function () {
            $('.view-details').on('click', function () {
                const cardNumber = $(this).data('card-number');
                const expiry = $(this).data('expiry');

                // Populate the modal with card details
                $('#cardNumber').text('**** **** **** ' + cardNumber.slice(-4)); // Show last 4 digits
                $('#cardExpiry').text(expiry.slice(0, 2) + expiry.slice(2, 4));

                // Show the modal
                $('#paymentDetailsModal').modal('show');
            });
        });

        $(document).ready(function () {
            // ZIP code input field
            var zipInput = $('#add-zip');

            // Listen to form submission
            $('form').on('submit', function (e) {
                e.preventDefault(); // Prevent form submission

                // Call the checkZipCode function
                if (checkZipCode(zipInput.val())) {
                    // If valid, proceed with AJAX call or form submission
                    // Serialize form data
                    var formData = $(this).serialize();

                    $.ajax({
                        url: '/addnewaddress', // API endpoint
                        type: 'POST',
                        data: formData,
                        success: function (response) {
                            if (response.status) {
                                $.confirm({
                                    title: 'Success!',
                                    content: '<div style="text-align:center;"><i class="ci-check-circle" style="font-size: 2rem; color: green;"></i><br/>Address added successfully!</div>',
                                    type: 'green',
                                    icon: 'fa fa-check-circle', // Add icon to success message
                                    boxWidth: '400px',
                                    useBootstrap: false, // Disable bootstrap to customize width
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    buttons: {
                                        ok: {
                                            text: "Great!",
                                            btnClass: 'btn-success',
                                            action: function () {
                                                window.location.reload();
                                            }
                                        }
                                    }
                                });
                            } else {
                                $.confirm({
                                    title: 'Failed to add address!',
                                    content: '<div style="text-align:center;"><i class="ci-close-circle" style="font-size: 2rem; color: red;"></i><br/>Failed to add address.</div>',
                                    type: 'red',
                                    icon: 'fa fa-check-circle', // Add icon to success message
                                    boxWidth: '400px',
                                    useBootstrap: false, // Disable bootstrap to customize width
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    buttons: {
                                        ok: {
                                            text: "Great!",
                                            btnClass: 'btn-success',
                                            action: function () {
                                                // Optional action on close
                                            }
                                        }
                                    }
                                });


                                $.confirm({
                                    title: 'Failed!',
                                    content: 'Failed to add address.',
                                    type: 'red',
                                    buttons: {
                                        ok: {
                                            text: "Close",
                                            btnClass: 'btn-danger',
                                            action: function () {
                                                // Optional action on close
                                            }
                                        }
                                    }
                                });
                            }
                        },
                        error: function (xhr, status, error) {
                            $.confirm({
                                title: 'Failed!',
                                content: 'An error occurred while adding the address.',
                                type: 'red',
                                buttons: {
                                    ok: {
                                        text: "Close",
                                        btnClass: 'btn-danger',
                                        action: function () {
                                            // Optional action on close
                                        }
                                    }
                                }
                            });
                        }
                    });
                } else {
                    // If ZIP code is invalid, show error
                    zipInput.addClass('is-invalid');
                }
            });

            // Function to check the ZIP code
            function checkZipCode(zip) {
                var zipPattern = /^[0-9]{5}(?:-[0-9]{4})?$/; // U.S. ZIP code (5 digits or 5+4 digits)
                return zipPattern.test(zip); // Returns true if valid, false otherwise
            }

            // Clear validation error on input change
            zipInput.on('input', function () {
                $(this).removeClass('is-invalid');
            });
        });

        // call api for add new cart
        $(document).ready(function () {
            $('#addPaymentForm').on('submit', function (e) {
                e.preventDefault();
                var formData = $(this).serialize();

                $.ajax({
                    url: '/useraddaccount', // Your backend endpoint
                    type: 'POST',
                    data: formData,
                    success: function (response) {
                        if (response.status) {
                            $.confirm({
                                title: 'Add new card success!',
                                content: '<div style="text-align:center;"><i class="ci-check-circle" style="font-size: 2rem; color: green;"></i><br/>Address added successfully!</div>',
                                type: 'green',
                                icon: 'fa fa-check-circle', // Add icon to success message
                                boxWidth: '400px',
                                useBootstrap: false, // Disable bootstrap to customize width
                                animation: 'zoom',
                                closeAnimation: 'scale',
                                buttons: {
                                    ok: {
                                        text: "Great!",
                                        btnClass: 'btn-success',
                                        action: function () {
                                            window.location.reload();
                                        }
                                    }
                                }
                            });
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error:', error);
                        setTimeout(() => {
                            window.location.reload();
                        }, 3000);
                    }
                });
            });
        });
        function showOrderDetails(order) {
            const orderDetailsContainer = document.getElementById("orderDetails");

            // Cập nhật tiêu đề đơn hàng
            const orderTitle = orderDetailsContainer.querySelector("#orderDetailsLabel");
            const showitem = document.getElementById('showitem');
            const date = document.querySelector(".dateorder")
            const Shippingaddress = document.querySelector(".Shippingaddress");
            const Tracking = document.querySelector(".Tracking");
            // const OrderStatus = document.querySelector(".OrderStatus");
            const Estimatedtotal = document.querySelector('.Estimatedtotal');
            const statusIndicator = document.getElementById('status-indicator');
            const ProcessStatus = document.getElementById('ProcessStatus');

            const cancelOrderBtn = document.getElementById('cancelOrderBtn');
            const container = document.querySelector('.cancelbtnoff');
            const link = document.createElement('a');
            container.innerHTML = '';
            link.id = 'cancelOrderBtn';
            link.className = 'btn btn-lg w-100';
            link.href = '#!';

            if (order.status === 'Placed') {
                link.style.backgroundColor = 'red';
                link.style.color = 'white';
                link.style.pointerEvents = 'auto';
                link.style.opacity = '1';
                link.textContent = 'Cancel Order'; // Nội dung hiển thị của thẻ a
            } else {
                link.style.backgroundColor = 'lightcoral'; // Màu sắc nhạt hơn
                link.style.color = 'gray'; // Màu chữ có thể thay đổi nếu cần
                link.style.pointerEvents = 'none'; // Không cho phép click nếu không phải 'Placed'
                link.style.opacity = '1'; // Giảm độ mờ
                link.textContent = 'Cannot Cancel'; // Nội dung hiển thị cho trạng thái khác
            }

            container.appendChild(link);

            orderTitle.innerText = `Order: # ${order.id}`;
            showitem.innerHTML = "";
            ProcessStatus.innerText = order.status
            order.orderDetails.forEach(detail => {
                const product = detail.product;
                const productHTML = `
                <div class="d-flex flex-column gap-3">
                    <div class="d-flex align-items-center">
                        <a class="flex-shrink-0" href="#">
                            <img src="${product.images[0].url}" width="110" alt="${product.name}">
                        </a>
                        <div class="w-100 min-w-0 ps-2 ps-sm-3">
                            <h5 class="d-flex animate-underline mb-2">
                                <a class="d-block fs-sm fw-medium text-truncate animate-target" href="#">
                                    ${product.name}
                                </a>
                            </h5>
                            <div class="h6 mb-2">$${product.price}</div>
                            <div class="fs-xs">Qty: ${detail.quantity}</div>
                        </div>
                    </div>
                </div>
            `;
                showitem.innerHTML += productHTML;
            });

            // const datenew = new Date(order.orderDate);
            // datenew.setDate(datenew.getDate() + 7);
            let formattedDate = '';
            try {
                const dateStr = order.orderDate;
                const date = new Date(dateStr);

                if (!isNaN(date.getTime())) {  // Check if the date is valid
                    // Add 4 days
                    date.setDate(date.getDate() + 4);

                    // Format the new date as "Nov. 12 2024"
                    const options = { year: 'numeric', month: 'short', day: 'numeric' };
                    formattedDate = date.toLocaleDateString('en-US', options).replace(',', '');
                } else {
                    console.error("Invalid date format");
                }
            } catch (error) {
                console.log(error);
            }

            date.innerText = formattedDate.toString();
            const maxLength = 35;
            Shippingaddress.innerText = order.AddressOrderShip.length > maxLength
                ? order.AddressOrderShip.substring(0, maxLength) + "..."
                : order.AddressOrderShip;

            Tracking.innerHTML = `<a href="getorderNologin?email=''&Orderid=${order.id}">${order.StackingID ? order.StackingID : "Updating"}</a>`;
            Estimatedtotal.innerText = "$" + order.totalAmount;
            // OrderStatus.innerText = order.status;
            const offcanvas = new bootstrap.Offcanvas(orderDetailsContainer);
            offcanvas.show();
            const btnca = document.getElementById("cancelOrderBtn");

            btnca.addEventListener("click", function (event) {
                event.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ <a>

                // Hiển thị hộp thoại xác nhận trước khi hủy đơn hàng
                $.confirm({
                    title: 'Confirm Cancellation',
                    content: 'Are you sure you want to cancel this order?',
                    buttons: {
                        confirm: {
                            text: 'Yes, Cancel',
                            btnClass: 'btn-danger',
                            action: function () {
                                const orderId = order.id;
                                fetch(`/cancelOrder`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        orderId: orderId
                                    }),
                                })
                                    .then(response => {
                                        window.location.reload();
                                    })
                                    .then(data => {
                                        $.confirm({
                                            title: 'Success!',
                                            content: `Order #${orderId} has been cancelled successfully.`,
                                            type: 'green',
                                            buttons: {
                                                ok: {
                                                    text: 'OK',
                                                    btnClass: 'btn-success',
                                                    action: function () {
                                                        window.location.reload();
                                                    }
                                                }
                                            }
                                        });
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        $.confirm({
                                            title: 'Error!',
                                            content: `There was an error canceling the order. Please try again.`,
                                            type: 'red',
                                            buttons: {
                                                ok: {
                                                    text: 'OK',
                                                    btnClass: 'btn-danger',
                                                    action: function () {
                                                        // Any additional action on success
                                                    }
                                                }
                                            }
                                        });
                                    });
                            }
                        },
                        cancel: {
                            text: 'No, Keep Order',
                            action: function () {
                                // Người dùng chọn không hủy đơn hàng
                                $.confirm({
                                    title: 'Order Status',
                                    content: 'Order was not canceled.',
                                    type: 'red',
                                    buttons: {
                                        ok: {
                                            text: 'OK',
                                            btnClass: 'btn-danger',
                                            action: function () {
                                                // Bất kỳ hành động bổ sung nào nếu cần
                                            }
                                        }
                                    }
                                });
                            }
                        }
                    }
                });
            });
        }



        function validateCVV(cvvInput) {
            const cvvError = document.getElementById('cvv-error');
            if (cvvInput.value.length !== 3) {
                cvvError.style.display = 'block';
            } else {
                cvvError.style.display = 'none';
            }
        }
        function formatCardNumber(cardInput) {
            const cardValue = cardInput.value.replace(/\D/g, '');
            const formattedValue = cardValue.replace(/(\d{4})(?=\d)/g, '$1 ');
            cardInput.value = formattedValue.trim();
            validateCardNumber(cardValue);
        }
        function formatExpiryDate(input) {
            let value = input.value.replace(/\D/g, ''); // Remove any non-digit characters

            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4); // Insert '/' after the month
            }

            input.value = value; // Set the formatted value back to the input
        }


        function validateCardNumber(cardNumber) {
            let sum = 0;
            let shouldDouble = false;
            for (let i = cardNumber.length - 1; i >= 0; i--) {
                let digit = parseInt(cardNumber.charAt(i));
                if (shouldDouble) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9;
                    }
                }
                sum += digit;
                shouldDouble = !shouldDouble;
            }
            const isValid = sum % 10 === 0;
            document.getElementById('card-error').style.display = isValid ? 'none' : 'block';
            return isValid;
        }


        document.addEventListener('DOMContentLoaded', function () {
            const countrySelect = document.getElementById('country-select');
            const citySelect = document.getElementById('city-select');

            // Lấy danh sách quốc gia từ REST Countries API
            fetch('https://restcountries.com/v3.1/all')
                .then(response => response.json())
                .then(countries => {
                    countries.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country.cca2; // Lưu mã quốc gia (ISO Alpha-2)
                        option.textContent = country.name.common;
                        countrySelect.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching countries:', error));

            // Khi người dùng chọn quốc gia, lấy danh sách thành phố
            countrySelect.addEventListener('change', function () {
                const selectedCountryCode = countrySelect.value;

                // Xóa các thành phố cũ
                citySelect.innerHTML = '<option value="">Select city...</option>';

                if (selectedCountryCode) {
                    // Sử dụng GeoDB Cities API để lấy thành phố (thay YOUR_API_KEY bằng khóa API của bạn)
                    fetch(`https://wft-geo-db.p.rapidapi.com/v1/geo/cities?countryIds=${selectedCountryCode}`, {
                        method: 'GET',
                        headers: {
                            'X-RapidAPI-Key': 'YOUR_API_KEY', // Thay YOUR_API_KEY bằng khóa API của bạn
                            'X-RapidAPI-Host': 'wft-geo-db.p.rapidapi.com'
                        }
                    })
                        .then(response => response.json())
                        .then(data => {
                            const cities = data.data;
                            if (cities && cities.length > 0) {
                                cities.forEach(city => {
                                    const option = document.createElement('option');
                                    option.value = city.city;
                                    option.textContent = city.city;
                                    citySelect.appendChild(option);
                                });
                            } else {
                                const option = document.createElement('option');
                                option.textContent = 'No cities found';
                                citySelect.appendChild(option);
                            }
                        })
                        .catch(error => console.error('Error fetching cities:', error));
                }
            });
        });
    </script>


</body>

</html>